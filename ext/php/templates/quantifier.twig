{% set id = varid() %}
{% set subres_var = '$result' ~ id %}
{% set child = expr.children[0] %}
/**
 * matching {{expr.asRhs()}}
 */
$pos{{id}} = $this->pos;
$count{{id}} = 0;
$children{{id}} = [];
while ($count{{id}} < {{expr.max}}) {
    {{subres_var}} = null;
{% filter indent -%}
{% include expr_tpl(child) with {'expr': child, 'result_var': subres_var} only %} 
{%- endfilter %}
    if (!{{subres_var}}) {
        break;
    }
    $count{{id}}++;
    $children{{id}}[] = {{subres_var}};
    $length = {{subres_var}}->end - {{subres_var}}->start;
    if (!$length) {
        break;
    }
}
if ($count{{id}} >= {{expr.min}}) {
    {{result_var}} = new Node\Quantifier('{{expr.name}}', $this->text, $pos{{id}}, $this->pos, $children{{id}});
} else {
    $this->pos = $pos{{id}};
}
