{% extends "expr.twig" %}

{# TODO: should we register a failure ? #}

{% block matching %}
{{ pos_var }} = $this->pos;
{{ render_expr(expr[0], context) }}
{{ expr_comment(expr, 'result') }}
{{ result_var }} = !{{ result_varname(expr[0]) }};
if (!{{ result_var }}) {
    {{ failure(context.rule, expr, pos_var)|indent }}
}
$this->pos = {{ pos_var }};
{%- endblock matching %}

{% block capturing %}
{{ pos_var }} = $this->pos;
{{ start_non_capturing(expr) }}
{{ render_expr(expr[0], context.matching()) }}
{{ expr_comment(expr, 'result') }}
{{ result_var }} = !{{ result_varname(expr[0]) }};
{{ end_non_capturing(expr) }}
if (!{{ result_var }}) {
    {{ failure(context.rule, expr, pos_var)|indent }}
}
$this->pos = {{ pos_var }};
{%- endblock capturing %}
